<!DOCTYPE html>
<html lang="ja">
    <head>
        <%
        const date = new Date().toLocaleString("ja-JP", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit"
        }).replaceAll("/", "").replaceAll(" ", "").replaceAll(":", "");
        %>
        <title><%= info.name %>'s Profile | Mamestagram</title>
        <meta name="robots" content="noindex">
        <%- include("link") %>
        <link rel="stylesheet" href="/css/profile.css?<%= date %>" />
        <script src="/jquery/profile.js?<%= date %>" nonce="<%= cspNonce %>" defer></script>
        <style>
            body::-webkit-scrollbar-track {
                background-color: #fdfdfd;
            }
            body::-webkit-scrollbar-thumb {
                background-color: #2e293d;
            }

            header {
                background-color: transparent;
            }

            .animated {
                background-color: #345c84;
            }

            .animated .pc li:hover {
                background-color: #6495ed;
            }

            @media (max-width: 1232px) {
                header {
                    background-color: #345c84;
                }
            }

            .mobile {
                background-color: #24222a;
            }

            .mobile li:hover {
                background-color: #4169e1;
            }

            .mobile .register, .mobile .login, .mobile .avatar {
                background-color: #35364d;
                color: #6495ed;
            }
            .mobile .register:hover, .mobile .login:hover, .mobile .avatar:hover {
                background-color: #35364d;
            }

            .link-form a, .link-form button {
                background-color: #345c84;
            }
            .link-form a:hover, .link-form button:hover {
                background-color: #6495ed;
            }

            .search-form .searchbox {
                background-color: #2c2c2c;
            }

            .search-form .searchbox .txtbox {
                border-bottom: 2px solid #757575;
            }
        </style>

        <%
        const getPlayTime = (time) => {
            let rst = { 
                time: "",
                hour: (time / (60 * 60)).toFixed(2).toLocaleString()
            };
            rst.time += Math.floor(time / (24 * 60 * 60)).toLocaleString() + "d ";
            time %= 86400;
            rst.time += Math.floor(time / (60 * 60)).toLocaleString() + "h ";
            time %= 3600;
            rst.time += Math.floor(time / 60).toLocaleString() + "m";
            return rst;
        }

        const getLastOnline = (unix, t) => {
            const cur = Math.floor(Date.now() / 1000);
            const time = cur - unix;
            if (time < 60) {
                return "Just now";
            }
            else if (time < (60 * 60)) {
                return `${Math.floor(time / 60)} ${t === "l" ? "minute(s)" : "m"} ago`;
            }
            else if (time < (24 * 60 * 60)) {
                return `${Math.floor(time / (60 * 60))} ${t === "l" ? "hour(s)" : "h"} ago`;
            }
            else if (time < (7 * 24 * 60 * 60)) {
                return `${Math.floor(time / (24 * 60 * 60))} ${t === "l" ? "day(s)" : "d"} ago`;
            }
            else if (time < (30 * 24 * 60 * 60)) {
                return `${Math.floor(time / (7 * 24 * 60 * 60))} ${t === "l" ? "week(s)" : "w"} ago`;
            }
            else if (time < (365 * 24 * 60 * 60)) {
                return `${Math.floor(time / (30 * 24 * 60 * 60))} ${t === "l" ? "month(s)" : "M"} ago`;
            }
            else {
                return `${Math.floor(time / (365 * 24 * 60 * 60))} ${t === "l" ? "year(s)" : "y"} ago`;
            }
        }

        const codeToTimezone = (country) => {
            const zone = {
                "ad": "Europe/Andorra",
                "ae": "Asia/Dubai",
                "af": "Asia/Kabul",
                "ag": "America/Antigua",
                "ai": "America/Anguilla",
                "al": "Europe/Tirane",
                "am": "Asia/Yerevan",
                "ao": "Africa/Luanda",
                "ar": "America/Argentina/Buenos_Aires",
                "as": "Pacific/Pago_Pago",
                "at": "Europe/Vienna",
                "au": "Australia/Sydney",
                "aw": "America/Aruba",
                "ax": "Europe/Mariehamn",
                "az": "Asia/Baku",
                "ba": "Europe/Sarajevo",
                "bb": "America/Barbados",
                "bd": "Asia/Dhaka",
                "be": "Europe/Brussels",
                "bf": "Africa/Ouagadougou",
                "bg": "Europe/Sofia",
                "bh": "Asia/Bahrain",
                "bi": "Africa/Bujumbura",
                "bj": "Africa/Porto-Novo",
                "bl": "America/St_Barthelemy",
                "bm": "Atlantic/Bermuda",
                "bn": "Asia/Brunei",
                "bo": "America/La_Paz",
                "bq": "America/Kralendijk",
                "br": "America/Sao_Paulo",
                "bs": "America/Nassau",
                "bt": "Asia/Thimphu",
                "bv": "Atlantic/Bouvet",
                "bw": "Africa/Gaborone",
                "by": "Europe/Minsk",
                "bz": "America/Belize",
                "ca": "America/Toronto",
                "cc": "Australia/Cocos", // 非対応
                "cd": "Africa/Kinshasa",
                "cf": "Africa/Bangui",
                "cg": "Africa/Brazzaville",
                "ch": "Europe/Zurich",
                "ci": "Africa/Abidjan",
                "ck": "Pacific/Rarotonga",
                "cl": "America/Santiago",
                "cm": "Africa/Douala",
                "cn": "Asia/Shanghai",
                "co": "America/Bogota",
                "cr": "America/Costa_Rica",
                "cu": "America/Havana",
                "cv": "Atlantic/Cape_Verde",
                "cw": "America/Curacao",
                "cx": "Australia/Christmas", // 非対応
                "cy": "Asia/Nicosia",
                "cz": "Europe/Prague",
                "de": "Europe/Berlin",
                "dj": "Africa/Djibouti",
                "dk": "Europe/Copenhagen",
                "dm": "America/Dominica",
                "do": "America/Santo_Domingo",
                "dz": "Africa/Algiers",
                "ec": "America/Guayaquil",
                "ee": "Europe/Tallinn",
                "eg": "Africa/Cairo",
                "eh": "Africa/El_Aaiun",
                "er": "Africa/Asmara",
                "es": "Europe/Madrid",
                "et": "Africa/Addis_Ababa",
                "fi": "Europe/Helsinki",
                "fj": "Pacific/Fiji",
                "fm": "Pacific/Chuuk",
                "fo": "Atlantic/Faroe",
                "fr": "Europe/Paris",
                "ga": "Africa Libreville",
                "gb": "Europe/London",
                "gd": "America/Grenada",
                "ge": "Asia/Tbilisi",
                "gf": "America/Cayenne",
                "gg": "Europe/Guernsey",
                "gh": "Africa/Accra",
                "gi": "Europe/Gibraltar",
                "gl": "America/Godthab",
                "gm": "Africa/Banjul",
                "gn": "Africa/Conakry",
                "gp": "America/Guadeloupe",
                "gq": "Africa/Malabo",
                "gr": "Europe/Athens",
                "gt": "America/Guatemala",
                "gu": "Pacific/Guam",
                "gw": "Africa/Bissau",
                "gy": "America/Guyana",
                "hk": "Asia/Hong_Kong",
                "hm": "Australia/Hugh_Henry", // 非対応
                "hn": "America/Tegucigalpa",
                "hr": "Europe/Zagreb",
                "ht": "America/Port-au-Prince",
                "hu": "Europe/Budapest",
                "id": "Asia/Jakarta",
                "ie": "Europe/Dublin",
                "il": "Asia/Tel_Aviv",
                "im": "Europe/Isle_of_Man",
                "in": "Asia/Kolkata",
                "io": "Indian/Chagos",
                "iq": "Asia/Baghdad",
                "ir": "Asia/Tehran",
                "is": "Atlantic/Reykjavik",
                "it": "Europe/Rome",
                "je": "Europe/Jersey",
                "jm": "America/Jamaica",
                "jo": "Asia/Amman",
                "jp": "Asia/Tokyo",
                "ke": "Africa/Nairobi",
                "kg": "Asia/Bishkek",
                "kh": "Asia/Phnom_Penh",
                "ki": "Pacific/Tarawa",
                "km": "Indian/Comoro",
                "kn": "America/St_Kitts",
                "kp": "Asia/Pyongyang",
                "kr": "Asia/Seoul",
                "kw": "Asia/Kuwait",
                "ky": "America/Cayman",
                "kz": "Asia/Almaty",
                "la": "Asia/Vientiane",
                "lb": "Asia/Beirut",
                "lc": "America/St_Lucia",
                "li": "Europe/Liechtenstein",
                "lk": "Asia/Colombo",
                "lr": "Africa/Monrovia",
                "ls": "Africa/Maseru",
                "lt": "Europe/Vilnius",
                "lu": "Europe/Luxembourg",
                "lv": "Europe/Riga",
                "ly": "Africa/Tripoli",
                "ma": "Africa/Casablanca",
                "mc": "Europe/Monaco",
                "md": "Europe/Chisinau",
                "me": "Europe/Podgorica",
                "mf": "America/Marigot",
                "mg": "Indian/Antananarivo",
                "mh": "Pacific/Majuro",
                "mk": "Europe/Skopje",
                "ml": "Africa/Bamako",
                "mm": "Asia/Yangon",
                "mn": "Asia/Ulaanbaatar",
                "mo": "Asia/Macau",
                "mp": "Pacific/Northern_Mariana",
                "mq": "America/Martinique",
                "mr": "Africa/Nouakchott",
                "ms": "America/Montserrat",
                "mt": "Europe/Malta",
                "mu": "Indian/Mauritius",
                "mv": "Indian/Maldives",
                "mw": "Africa/Blantyre",
                "mx": "America/Mexico_City",
                "my": "Asia/Kuala_Lumpur",
                "mz": "Africa/Maputo",
                "na": "Africa/Windhoek",
                "nc": "Pacific/Noumea",
                "ne": "Africa/Niamey",
                "nf": "Pacific/Norfolk",
                "ng": "Africa/Lagos",
                "ni": "America/Managua",
                "nl": "Europe/Amsterdam",
                "no": "Europe/Oslo",
                "np": "Asia/Kathmandu",
                "nr": "Pacific/Nauru",
                "nu": "Pacific/Niue",
                "nz": "Pacific/Auckland",
                "om": "Asia/Muscat",
                "pa": "America/Panama",
                "pe": "America/Lima",
                "pf": "Pacific/Tahiti",
                "pg": "Pacific/Port_Moresby",
                "ph": "Asia/Manila",
                "pk": "Asia/Karachi",
                "pl": "Europe/Warsaw",
                "pm": "America/St_Pierre",
                "pn": "Pacific/Pitcairn",
                "pr": "America/Puerto_Rico",
                "pt": "Europe/Lisbon",
                "pw": "Pacific/Palau",
                "py": "America/Asuncion",
                "qa": "Asia/Qatar",
                "re": "Indian/Reunion",
                "ro": "Europe/Bucharest",
                "rs": "Europe/Belgrade",
                "ru": "Europe/Moscow",
                "rw": "Africa/Kigali",
                "sa": "Asia/Riyadh",
                "sb": "Pacific/Guadalcanal",
                "sc": "Indian/Seychelles",
                "sd": "Africa/Khartoum",
                "se": "Europe/Stockholm",
                "sg": "Asia/Singapore",
                "sh": "Atlantic/St_Helena",
                "si": "Europe/Ljubljana",
                "sj": "Arctic/Longyearbyen",
                "sk": "Europe/Bratislava",
                "sl": "Africa/Freetown",
                "sm": "Europe/San_Marino",
                "sn": "Africa/Dakar",
                "so": "Africa/Mogadishu",
                "sr": "America/Paramaribo",
                "ss": "Africa/Juba",
                "st": "Africa/Sao_Tome",
                "sv": "America/El_Salvador",
                "sx": "America/Curacao",
                "sy": "Asia/Damascus",
                "sz": "Africa/Mbabane",
                "tc": "America/Grand_Turk",
                "td": "Africa/Ndjamena",
                "tf": "Indian/Kerguelen",
                "tg": "Africa/Lome",
                "th": "Asia/Bangkok",
                "tj": "Asia/Dushanbe",
                "tk": "Pacific/Tokelau",
                "tl": "Asia/Dili",
                "tm": "Asia/Ashgabat",
                "tn": "Africa/Tunis",
                "to": "Pacific/Tongatapu",
                "tr": "Europe/Istanbul",
                "tt": "America/Port_of_Spain",
                "tv": "Pacific/Tarawa",
                "tz": "Africa/Dar_es_Salaam",
                "ua": "Europe/Kiev",
                "ug": "Africa/Kampala",
                "um": "Pacific/Wake",
                "us": "America/New_York",
                "uy": "America/Montevideo",
                "uz": "Asia/Tashkent",
                "va": "Europe/Vatican",
                "vc": "America/St_Vincent",
                "ve": "America/Caracas",
                "vg": "America/Tortola",
                "vi": "America/St_Thomas",
                "vn": "Asia/Ho_Chi_Minh",
                "vu": "Pacific/Efate",
                "wf": "Pacific/Wallis",
                "ws": "Pacific/Apia",
                "ye": "Asia/Aden",
                "yt": "Indian/Mayotte",
                "za": "Africa/Johannesburg",
                "zm": "Africa/Lusaka",
                "zw": "Africa/Harare"
            };
            switch (country) {
                case "cc":
                case "cx":
                case "hm":
                    country = "au";
                    break;
            }
            return zone[country];
        }

        const getLocationTime = (unix, country) => {
            const time = clan ? unix : new Date(unix * 1000);
            const locationTime = time.toLocaleString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit",
                timeZone: codeToTimezone(country),
                timeZoneName: "short",
                language: "en"
            });
            return locationTime;
        }

        const getMods = (modNum) => {
            let mod = new Array(0);
            const mods = [
                "nf", // 0 : NoFail
                "ez", // 1 : Eazy
                "ts", // 2 : TouchScreen
                "hd", // 3 : Hidden
                "hr", // 4 : HardRock
                "sd", // 5 : SaddenDeath
                "dt", // 6 : DoubleTime
                "rx", // 7 : Relax
                "ht", // 8 : HalfTime
                "nc", // 9 : NightCore
                "fl", // 10 : FlashLight
                "at", // 11 : AutoPlay
                "so", // 12 : SpinOut
                "ap", // 13 : Autopilot
                "pf", // 14 : Perfect
                "k4", // 15 : Key4
                "k5", // 16 : Key5
                "k6", // 17 : Key6
                "k7", // 18 : Key7
                "k8", // 19 : Key8
                "fi", // 20 : FadeIn
                "rd", // 21 : Random
                "cm", // 22 : Cinema
                "tp", // 23 : TargetPoint
                "k9", // 24 : Key9
                "kc", // 25 : KeyCoop
                "k1", // 26 : Key1
                "k3", // 27 : Key3
                "k2", // 28 : Key2
                "v2", // 29 : ScoreV2
                "mr"  // 30 : Mirror
            ];
            for (let i = 30; i >= 0; i--) {
                if (i !== 2 && i !== 11 && i !== 19 && i !== 22 && !(i >= 24 && i <= 28) && modNum >= 1 << i) {
                    switch (i) {
                        case 14:
                            modNum -= 1 << 5;
                            break;
                        case 9:
                            modNum -= 1 << 6;
                            break;
                    }
                    mod.push(mods[i]);
                    modNum -= 1 << i;
                }
            }
            mod = sortMods(mod);
            return mod;
        }
        const sortMods = (mods) => {
            const order = ["rx", "ap", "k4", "k5", "k6", "k7", "nf", "ez", "ht", "hd", "hr", "dt", "nc", "sd", "pf", "fl", "fi", "rd", "mr", "so", "v2"];
            let rst = new Array(0);
            for (let i = 0; i < order.length; i++) {
                for (let mod of mods) {
                    if (mod === order[i]) {
                        rst.push(mod);
                        break;
                    }
                }
            }
            return rst;
        }
        const getMode = (modeNum) => {
            switch (modeNum) {
                case 0: return "osu";
                case 1: return "taiko";
                case 2: return "fruits";
                case 3: return "mania";
            }
        }
        const getModeName = (modeNum) => {
            let modeName;
            if (modeNum < 4) {
                modeName = "vn!";
            }
            else if (modeNum < 8) {
                modeName = "rx!";
            }
            else {
                modeName = "ap!";
            }
            switch (modeNum % 4) {
                case 0: modeName += "osu"; break;
                case 1: modeName += "taiko"; break;
                case 2: modeName += "ctb"; break;
                case 3: modeName += "mania"; break;
            }
            return modeName;
        }
        const getUserPriv = (n) => {
            const priv = [];
            const privName = ["", "", "Verified", "", "Supporter", "", "", "Arumni", "", "", "", "Nominator", "Moderator", "Administrator", "Developer"];
            if (n >= 1 << 14) {
                priv.push("Developer");
                return priv;
            }
            for (let i = 0; Math.pow(2, i) <= n; i++) {
                if (i === 3 || i === 6 || i === 8 || i === 9) continue;
                if ((n & 1 << i) > 0) {
                    if (privName[i] !== "") {
                        priv.push(privName[i]);
                    }
                }
            }
            return priv;
        }
        %>
    </head>
    <body>
        <img class="background-img" src="https://<%= clan ? "clan-" : "" %>bg.mamesosu.net/<%= id %>?<%= date %>" decoding="async" loading="lazy" alt="" width="100%" height="100%" />
        <%- include("header") %>
        <main>
            <% const cty = loginf ? country : "UTC"; %>
            <div class="box banner-box">
                <img src="https://<%= clan ? "clan-" : "" %>banner.mamesosu.net/<%= id %>?<%= date %>" decoding="async" loading="lazy" alt="" width="100%" height="250" />
            </div>
            <div class="box player-banner">
                <div class="string username">
                    <div class="avatar">
                        <img class="avatar" src="https://<%= clan ? "clan-" : "" %>a.mamesosu.net/<%= id %>?<%= date %>" decoding="async" loading="lazy" alt="" />
                        <% if (!clan && setBadge !== 0) { %>
                            <img class="gacha" src="/image/gacha/<%= setBadge %>.png?<%= date %>" onerror="this.onerror = null; this.src = '/image/gacha/<%= setBadge %>.gif?<%= date %>'" decoding="async" loading="lazy" alt="" />
                        <% } %>
                    </div>
                    <div>
                        <div class="flex-box">
                            <span
                            <% if ((!bRanking && !clan && !info.priv % 2 === 0 && ranking.global[0].value === 1) || (bRanking && !info.priv % 2 === 0 && ranking.bancho === 1) || (clan && info.public === 1 && ranking === 1)) { %>
                                class="champion"
                            <% } %>>
                                <h1 title="Created at <%= !clan ? getLocationTime(info.creation_time, cty) : getLocationTime(info.created_at, cty) %>"><%= info.name %></h1>
                                <% if ((!bRanking && !clan && !info.priv % 2 === 0 && ranking.global[0].value === 1) || (bRanking && !info.priv % 2 === 0 && ranking.bancho === 1) || (clan && info.public === 1 && ranking === 1)) { %>
                                    <p class="tooltip"><%= getModeName(modeNum) %> champion</p>
                                <% } %>
                            </span>
                            <% if (!clan && id === locals.userid) { %>
                                <a href="/edit&<%= !clan ? "personal" : "clan" %>" class="edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </a>
                            <% } %>
                            <% if (!clan) { %>
                                <i title="<%= info.country.toUpperCase() %>" class="flag-icon flag-icon-<%= info.country %>"></i>
                            <% } %>
                            <% if (!clan && info.priv % 2 !== 0) { %>
                                <div class="tag">
                                    <% getUserPriv(info.priv).forEach((tag) => { %>
                                        <span class="badge">
                                            <% if (tag === "Developer") { %>
                                                <i class="fa-solid fa-code" style="color: #3e70dd;"></i>
                                            <% } else if (tag === "Administrator") { %>
                                                <i class="fa-solid fa-crown" style="color: #f1c40f;"></i>
                                            <% } else if (tag === "Moderator") { %>
                                                <i class="fa-solid fa-shield-halved" style="color: #cf5757;"></i>
                                            <% } else if (tag === "Nominator") { %>
                                                <i class="fa-solid fa-screwdriver-wrench" style="color: #9000fc;"></i>
                                            <% } else if (tag === "Arumni") { %>
                                                <i class="fa-solid fa-graduation-cap" style="color: #99aab5;"></i>
                                            <% } else if (tag === "Supporter") { %>
                                                <i class="fa-solid fa-heart" style="color: #dd0000;"></i>
                                            <% } else if (tag === "Verified") { %>
                                                <i class="fa-solid fa-check" style="color: #3ce12f;"></i>
                                            <% } %>
                                            <p class="tooltip"><%= tag %></p>
                                        </span>
                                    <% }); %>
                                    <% if (rival) { %>
                                        <span class="badge rival">
                                            <i class="fa-solid fa-swords"></i>
                                            <p class="tooltip">Rival</p>
                                        </span>
                                    <% } %>
                                </div>
                            <% } %>
                        </div>
                        <% if (info.priv % 2 !== 0) { %>
                            <div class="tag tag-mobile">
                                <% getUserPriv(info.priv).forEach((tag) => { %>
                                    <span class="badge">
                                        <% if (tag === "Developer") { %>
                                            <i class="fa-solid fa-code" style="color: #3e70dd;"></i>
                                        <% } else if (tag === "Administrator") { %>
                                            <i class="fa-solid fa-crown" style="color: #f1c40f;"></i>
                                        <% } else if (tag === "Moderator") { %>
                                            <i class="fa-solid fa-shield-halved" style="color: #cf5757;"></i>
                                        <% } else if (tag === "Nominator") { %>
                                            <i class="fa-solid fa-screwdriver-wrench" style="color: #9000fc;"></i>
                                        <% } else if (tag === "Arumni") { %>
                                            <i class="fa-solid fa-graduation-cap" style="color: #99aab5;"></i>
                                        <% } else if (tag === "Supporter") { %>
                                            <i class="fa-solid fa-heart" style="color: #dd0000;"></i>
                                        <% } else if (tag === "Verified") { %>
                                            <i class="fa-solid fa-check" style="color: #3ce12f;"></i>
                                        <% } %>
                                        <p class="tooltip"><%= tag %></p>
                                    </span>
                                <% }); %>
                            </div>
                        <% } %>
                        <div class="flex-box">
                            <% if (!clan) { %>
                                <% if (info.show_pName === 1 && info.past_name !== null) { %>
                                    <p class="aka">aka: <%= info.past_name %></p>
                                <% } %>
                                <% if (beFollowed) { %>
                                    <p class="be-followed">Follows you</p>
                                <% } %>
                            <% } else { %>
                                <% if (info.show_pTag === 1 && info.past_tag !== null) { %>
                                    <p class="aka">aka: <%= info.past_tag %></p>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                    <% if (!clan && loginf && id !== locals.userid) { %>
                        <span id="follow">
                            <span class="follow-btn" onclick="clickFollowButton()"
                            <% if (followStatus === "following") { %>
                                style="background-color: #7ea015;"
                            <% } else if (followStatus === "mutual") { %>
                                style="background-color: #c4598c;"
                            <% } else { %>
                                style="background-color: #17171c;"
                            <% } %>>
                                <% if (followStatus !== "none") { %>
                                    <i class="fa-solid fa-user-xmark"></i>
                                    <p class="tooltip">Unfollow</p>
                                <% } else { %>
                                    <i class="fa-solid fa-user-plus"></i>
                                    <p class="tooltip">Follow</p>
                                <% } %>
                            </span>
                        </span>
                    <% } %>
                </div>
                <% if (!clan) { %>
                    <div id="relationships" class="string relationship">
                        <span id="mutual" class="mutual">
                            <i class="fa-solid fa-handshake-simple"></i>
                            <%= mutual %>
                            <p class="tooltip">Mutual</p>
                        </span>
                        <span id="following" class="following">
                            <i class="fa-solid fa-user"></i>
                            <%= following %>
                            <p class="tooltip">Following</p>
                        </span>
                        <span id="followers" class="followers">
                            <i class="fa-solid fa-user-group"></i>
                            <%= followers %>
                            <p class="tooltip">Followers</p>
                        </span>
                        <% if (mutualList.length > 0) { %>
                            <div class="list mutual-list">
                                <div class="wrap">
                                    <h1><i class="fa-solid fa-handshake-simple"></i>Mutual<i class="fa-solid fa-xmark"></i></h1>
                                    <div class="users">
                                        <% mutualList.forEach((data) => { %>
                                            <a class="data" href="/profile/<%= data.user2 %>">
                                                <img class="avatar" src="https://a.mamesosu.net/<%= data.user2 %>?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <div class="name">
                                                    <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                                    <p class="username"><%= data.name %></p>
                                                </div>
                                            </a>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        <% if (followingList.length > 0) { %>
                            <div class="list following-list">
                                <div class="wrap">
                                    <h1><i class="fa-solid fa-user"></i>Following<i class="fa-solid fa-xmark"></i></h1>
                                    <div class="users">
                                        <% followingList.forEach((data) => { %>
                                            <a class="data" href="/profile/<%= data.user2 %>">
                                                <img class="avatar" src="https://a.mamesosu.net/<%= data.user2 %>?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <div class="name">
                                                    <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                                    <p class="username"><%= data.name %></p>
                                                </div>
                                            </a>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        <% if (followersList.length > 0) { %>
                            <div class="list followers-list">
                                <div class="wrap">
                                    <h1><i class="fa-solid fa-user-group"></i>Followers<i class="fa-solid fa-xmark"></i></h1>
                                    <div class="users">
                                        <% followersList.forEach((data) => { %>
                                        <a class="data" href="/profile/<%= data.user1 %>">
                                            <img class="avatar" src="https://a.mamesosu.net/<%= data.user1 %>?<%= date %>" decoding="async" loading="lazy" alt="" />
                                            <div class="name">
                                                <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                                <p class="username"><%= data.name %></p>
                                            </div>
                                        </a>
                                    <% }); %>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        <div class="player-status">
                            <i class="status fa-solid fa-circle"
                            <% if (online) { %>
                                style="color: #b3d944;"
                            <% } else { %>
                                style="color: #000000;"
                            <% } %>></i>
                            <p>
                                <% if (online) { %>
                                    Online
                                <% } else { %>
                                    <span class="normal">Last seen: <strong title="<%= getLocationTime(info.latest_activity, cty) %>"><%= getLastOnline(info.latest_activity, "l") %></strong></span>
                                    <span class="short"><strong title="<%= getLocationTime(info.latest_activity, cty) %>"><%= getLastOnline(info.latest_activity, "s") %></strong></span>
                                <% } %>
                            </p>
                        </div>
                    </div>
                <% } %>
                <div id="selection" class="string selection">
                    <div class="special">
                        <button class="menu-title">
                            <% if (dans) { %>
                                Dans
                            <% } else if (bRanking) { %>
                                Bancho
                            <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                Classic
                            <% } else if (modeNum < 8) { %>
                                Relax
                            <% } else { %>
                                Auto Pilot
                            <% } %>
                            <% if (modeNum === info.preferred_mode && !dans && !bRanking) { %>
                                <i class="favorite fa-solid fa-star fa-xs"></i>
                            <% } %>
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                        <ul class="dropdown">
                            <!-- classic -->
                            <li class="classic">
                                <a
                                <% if (modeNum % 4 === 0 && !dans) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/std"
                                <% } else if (modeNum % 4 === 1) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taiko"
                                <% } else if (modeNum % 4 === 2) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctb"
                                <% } else { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/mania"
                                <% } %>>
                                    Classic
                                    <% if (info.preferred_mode >= 0 && info.preferred_mode < 4 && modeNum % 4 === info.preferred_mode % 4) { %>
                                        <i class="favorite fa-solid fa-star fa-xs"></i>
                                    <% } %>
                                </a>
                            </li>
                            <!-- relax -->
                            <% if (modeNum !== 3) { %>
                                <li class="relax">
                                    <a
                                    <% if (modeNum % 4 === 0) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/stdrx"
                                    <% } else if (modeNum % 4 === 1) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taikorx"
                                    <% } else if (modeNum % 4 === 2) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctbrx"
                                    <% } %>>
                                        Relax
                                        <% if (info.preferred_mode >= 4 && info.preferred_mode < 8 && modeNum % 4 === info.preferred_mode % 4) { %>
                                            <i class="favorite fa-solid fa-star fa-xs"></i>
                                        <% } %>
                                    </a>
                                </li>
                            <% } %>
                            <!-- auto pilot -->
                            <% if (modeNum % 4 === 0) { %>
                                <li class="auto-pilot">
                                    <a href="/profile/<%= id %><%= clan ? "&clan" : "" %>/stdap">
                                        Auto Pilot
                                        <% if (info.preferred_mode === 8) { %>
                                            <i class="favorite fa-solid fa-star fa-xs"></i>
                                        <% } %>
                                    </a>
                                </li>
                            <% } %>
                            <!-- dans -->
                            <li class="dans">
                                <a
                                <% if (modeNum % 4 === 0) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/std&dans"
                                <% } else if (modeNum % 4 === 1) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taiko&dans"
                                <% } else if (modeNum % 4 === 2) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctb&dans"
                                <% } else if (modeNum === 3) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/mania&dans"
                                <% } %>>Dans</a>
                            </li>
                            <!-- bancho lb -->
                            <% if (loginf && !clan && (priv & 1 << 4) > 0) { %>
                                <li>
                                    <a
                                    <% if (modeNum % 4 === 0) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/std?bRanking"
                                    <% } else if (modeNum % 4 === 1) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taiko?bRanking"
                                    <% } else if (modeNum % 4 === 2) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctb?bRanking"
                                    <% } else if (modeNum === 3) { %>
                                        href="/profile/<%= id %><%= clan ? "&clan" : "" %>/mania?bRanking"
                                    <% } %>>Bancho</a>
                                </li>
                            <% } %>
                        </ul>
                    </div>
                    <% if (((!clan && id === locals.userid) || (clan && info.owner === locals.userid)) && modeNum !== info.preferred_mode) { %>
                        <p class="set-favorite" onclick="setFavoriteMode()">set <%= getModeName(modeNum) %> as profile favorite gamemode</p>
                    <% } %>
                    <ul class="mode"
                        <% if ((!clan && id !== locals.userid) || (clan && info.owner !== locals.userid) || modeNum === info.preferred_mode) { %>
                            style="margin-left: auto;"
                        <% } %>>
                        <!-- std -->
                        <li class="std"
                        <% if (modeNum % 4 === 0) { %>
                            style="filter: invert(0%); opacity: 1"
                        <% } %>>
                            <a
                            <% if (dans) { %>
                                href="/profile/<%= id %><%= clan ? "&clan" : "" %>/std&dans"
                            <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                href="/profile/<%= id %><%= clan ? "&clan" : "" %>/std<%= bRanking ? "?bRanking" : "" %>"
                            <% } else if (modeNum < 7) { %>
                                href="/profile/<%= id %><%= clan ? "&clan" : "" %>/stdrx"
                            <% } else { %>
                                href="/profile/<%= id %><%= clan ? "&clan" : "" %>/stdap"
                            <% } %>><i class="mode-icon mode-osu"></i></a>
                            <% if (info.preferred_mode % 4 === 0) { %>
                                <i class="favorite fa-solid fa-star"></i>
                            <% } %>
                            </li>
                        <% if (modeNum !== 8) { %>
                            <!-- taiko -->
                            <li class="taiko"
                            <% if (modeNum % 4 === 1) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taiko&dans"
                                <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taiko<%= bRanking ? "?bRanking" : "" %>"
                                <% } else { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/taikorx"
                                <% } %>><i class="mode-icon mode-taiko"></i></a>
                                <% if (info.preferred_mode % 4 === 1) { %>
                                    <i class="favorite fa-solid fa-star"></i>
                                <% } %>
                            </li>
                            <!-- ctb -->
                            <li class="catch"
                            <% if (modeNum % 4 === 2) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctb&dans"
                                <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctb<%= bRanking ? "?bRanking" : "" %>"
                                <% } else { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/ctbrx"
                                <% } %>><i class="mode-icon mode-fruits"></i></a>
                                <% if (info.preferred_mode % 4 === 2) { %>
                                    <i class="favorite fa-solid fa-star"></i>
                                <% } %>
                            </li>
                        <% } %>
                        <!-- mania -->
                        <% if (modeNum >= 0 && modeNum < 4) { %>
                            <li class="mania"
                            <% if (modeNum === 3) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/mania&dans"
                                <% } else { %>
                                    href="/profile/<%= id %><%= clan ? "&clan" : "" %>/mania<%= bRanking ? "?bRanking" : "" %>"
                                <% } %>><i class="mode-icon mode-mania"></i></a>
                                <% if (info.preferred_mode % 4 === 3) { %>
                                    <i class="favorite fa-solid fa-star"></i>
                                <% } %>
                            </li>
                        <% } %>
                    </ul>
                </div>
                <div class="string player-info">
                    <div class="overview">
                        <div class="wrap ranking">
                            <% if (bRanking) { %>
                                <div class="global">
                                    <h1>Bancho Ranking</h1>
                                    <h2>
                                        <% if (((!dans && info.acc === 0) || (dans && acc === 0)) || info.priv % 2 === 0) { %>
                                            -
                                        <% } else { %>
                                            #<%= ranking.bancho.toLocaleString() %>
                                        <% } %>
                                    </h2>
                                </div>
                            <% } else if (!clan) { %>
                                <div class="global">
                                    <h1>Global Ranking</h1>
                                    <h2>
                                        <% if (((!dans && info.acc === 0) || (dans && acc === 0)) || info.priv % 2 === 0) { %>
                                            -
                                        <% } else { %>
                                            #<%= ranking.global[0].value.toLocaleString() %>
                                        <% } %>
                                    </h2>
                                </div>
                                <div class="country">
                                    <h1>Country Ranking</h1>
                                    <h2>
                                        <% if (((!dans && info.acc === 0) || (dans && acc === 0)) || info.priv % 2 === 0) { %>
                                            -
                                        <% } else { %>
                                            #<%= ranking.country[0].value.toLocaleString() %>
                                        <% } %>
                                    </h2>
                                </div>
                            <% } else { %>
                                <div class="global">
                                    <h1>Clan Ranking</h1>
                                    <h2>
                                        <% if (acc === 0 || info.public === 0) { %>
                                            -
                                        <% } else { %>
                                            #<%= ranking.toLocaleString() %>
                                        <% } %>
                                    </h2>
                                </div>
                            <% } %>
                        </div>
                        <div class="wrap detail">
                            <div class="medals"
                            <% if (dans) { %>
                                style="filter: invert(50%); opacity: 0.95;"
                            <% } %>>
                                <h1>Medals</h1>
                                <h2><%= Math.floor(medals).toLocaleString() %></h2>
                            </div>
                            <div class="pp">
                                <h1>pp</h1>
                                <h2>
                                    <% if (dans || clan) { %>
                                        <%= Math.round(pp).toLocaleString() %>
                                    <% } else { %>
                                        <%= Math.round(info.pp).toLocaleString() %>
                                    <% } %>
                                </h2>
                            </div>
                            <div title="<%= getPlayTime(info.playtime).hour %> hours" class="playtime"
                            <% if (dans) { %>
                                style="filter: invert(50%); opacity: 0.95;"
                            <% } %>>
                                <h1>Total Play Time</h1>
                                <h2><%= getPlayTime(info.playtime).time %></h2>
                            </div>
                        </div>
                        <div class="wrap grade-amounts">
                            <div class="xh">
                                <img src="/image/grade/XH.png?<%= date %>" decoding="async" loading="lazy" alt="" /><br>
                                <%= !dans ? Math.floor(info.xh_count).toLocaleString() : Math.floor(grade.xh[0].value).toLocaleString() %>
                            </div>
                            <div class="x">
                                <img src="/image/grade/X.png?<%= date %>" decoding="async" loading="lazy" alt="" /><br>
                                <%= !dans ? Math.floor(info.x_count).toLocaleString() : Math.floor(grade.x[0].value).toLocaleString() %>
                            </div>
                            <div class="sh">
                                <img src="/image/grade/SH.png?<%= date %>" decoding="async" loading="lazy" alt="" /><br>
                                <%= !dans ? Math.floor(info.sh_count).toLocaleString() : Math.floor(grade.sh[0].value).toLocaleString() %>
                            </div>
                            <div class="s">
                                <img src="/image/grade/S.png?<%= date %>" decoding="async" loading="lazy" alt="" /><br>
                                <%= !dans ? Math.floor(info.s_count).toLocaleString() : Math.floor(grade.s[0].value).toLocaleString() %>
                            </div>
                            <div class="a">
                                <img src="/image/grade/A.png?<%= date %>" decoding="async" loading="lazy" alt="" /><br>
                                <%= !dans ? Math.floor(info.a_count).toLocaleString() : Math.floor(grade.a[0].value).toLocaleString() %>
                            </div>
                        </div>
                    </div>
                    <d class="stats">
                        <div class="acc">
                            <h1>Hit Accuracy</h1>
                            <h2>
                                <% if (dans || clan) { %>
                                    <%= acc.toFixed(2) %>
                                <% } else { %>
                                    <%= info.acc.toFixed(2) %>
                                <% } %>
                                %
                            </h2>
                        </div>
                        <div class="playcount">
                            <h1>Play Count</h1>
                            <h2>
                                <% if (dans || clan) { %>
                                    <%= Math.floor(plays).toLocaleString() %>
                                <% } else { %>
                                    <%= Math.floor(info.plays).toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="hits"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Total hits</h1>
                            <h2>
                                <% if (!dans && clan) { %>
                                    <%= Math.floor(hits).toLocaleString() %>
                                <% } else { %>
                                    <%= Math.floor(info.total_hits).toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="rankedscore"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Ranked Score</h1>
                            <h2>
                                <% if (!dans && clan) { %>
                                    <%= Math.floor(score.ranked[0].value).toLocaleString() %>
                                <% } else { %>
                                    <%= Math.floor(info.rscore).toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="totalscore"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Total Score</h1>
                            <h2>
                                <% if (!dans && clan) { %>
                                    <%= Math.floor(score.total[0].value).toLocaleString() %>
                                <% } else { %>
                                    <%= Math.floor(info.tscore).toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="maxcombo">
                            <h1>Maximum Combo</h1>
                            <h2>
                                <% if (dans) { %>
                                    <%= max_combo.toLocaleString() %>
                                <% } else { %>
                                    <%= info.max_combo.toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="watched"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Replays Watched</h1>
                            <h2><%= info.replay_views.toLocaleString() %></h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box me">
                <h1><i class="fa-solid fa-id-badge"></i>me!</h1>
                <p class="edit-button" style="display: none;">
                    <i class="fa-solid fa-pen"></i>
                </p>
                <div class="contents">
                    <div id="put-bbcode" class="bbcode-profile" style="display: none;">
                        <% if (bbcode === null) { %>
                            <div class="me-empty">
                                <% if ((!clan && id === locals.userid) || (clan && info.owner === locals.userid)) { %>
                                    <p class="edit-me">Edit me!</p>
                                    <i class="fa-solid fa-user-pen"></i>
                                    <p class="description">Express yourself by editing <strong>me!</strong></p>
                                <% } else { %>
                                    <p class="nothing">No contents</p>
                                <% } %>
                            </div>
                        <% } %>
                        <%= me %>
                    </div>
                    <form action="/me" method="post" style="display: none;">
                        <textarea id="me-editor" placeholder="Type page content here" name="content"><%= bbcode %></textarea>
                        <div class="editor">
                            <div class="bb-button">
                                <p title="Heading" class="heading">
                                    <i class="fa-solid fa-heading"></i>
                                </p>
                                <p title="Bold" class="bold">
                                    <i class="fa-solid fa-bold"></i>
                                </p>
                                <p title="Italic" class="italic">
                                    <i class="fa-solid fa-italic"></i>
                                </p>
                                <p title="Underline" class="underline">
                                    <i class="fa-solid fa-underline"></i>
                                </p>
                                <p title="Strikethrough" class="strike">
                                    <i class="fa-solid fa-strikethrough"></i>
                                </p>
                                <p title="Color text" class="color">
                                    <i class="fa-solid fa-droplet"></i>
                                </p>
                                <p title="Spoiler" class="spoiler-text">
                                    <i class="fa-solid fa-rectangle-xmark"></i>
                                </p>
                                <p title="Center" class="center">
                                    <i class="fa-solid fa-align-center"></i>
                                </p>
                                <p title="Spoilerbox" class="spoilerbox">
                                    <i class="fa-solid fa-square-caret-down"></i>
                                </p>
                                <p title="List" class="list">
                                    <i class="fa-solid fa-list-ul"></i>
                                </p>
                                <p title="Numbered list" class="num-list">
                                    <i class="fa-solid fa-list-ol"></i>
                                </p>
                                <p title="Quote" class="quote">
                                    <i class="fa-solid fa-arrows-rotate"></i>
                                </p>
                                <p title="Image" class="image">
                                    <i class="fa-solid fa-image"></i>
                                </p>
                                <p title="Link" class="url">
                                    <i class="fa-solid fa-link"></i>
                                </p>
                                <p title="Profile" class="profile">
                                    <i class="fa-solid fa-address-card"></i>
                                </p>
                                <p title="Code block" class="code">
                                    <i class="fa-solid fa-code"></i>
                                </p>
                                <select title="Font size" class="size">
                                    <option value="title" hidden selected>Font size</option>
                                    <option value="tiny">Tiny</option>
                                    <option value="small">Small</option>
                                    <option value="normal">Normal</option>
                                    <option value="large">Large</option>
                                </select>
                                <a href="https://github.com/Mamestagram/BBCode-Usage" target="_blank" rel="noopener noreferrer">Help</a>
                            </div>
                            <div class="edit">
                                <p class="cancel" onclick="cancel()">Cancel</p>
                                <p class="preview" onclick="showPreview()">Preview</p>
                                <p class="back-to-edit" onclick="backToEditor()" style="display: none">Edit</p>
                                <p class="save" onclick="save()">Save</p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <% if (!clan) { %>
                <!-- best performance -->
                <div class="box bestpp">
                    <h1><i class="fa-regular fa-chart-bar"></i>Best Performance</h1>
                    <div class="mode-<%= modeNum %>">
                        <% let amt = 0; %>
                        <% if (bestpp.length === 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% bestpp.forEach((data) => { %>
                                <div class="wrap data">
                                    <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>&" decoding="async" loading="lazy" alt="" />
                                    <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>
                                    style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <div class="mods">
                                        <% getMods(data.mods).forEach((mod) => { %>
                                            <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% }); %>
                                    </div>
                                    <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                    <div class="pp">
                                        <p class="recorded"
                                            <% if (dans) { %>
                                                style="margin: auto";
                                            <% } %>>
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } %>
                                        </p>
                                        <% if (!dans) { %>
                                            <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt)).toLocaleString() %>pp)</p>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="data-mobile">
                                    <div class="flex info">
                                        <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <a
                                        <% if (!dans && data.id > 0) { %>
                                            href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                        <% } %>>
                                            <p class="title"><%= data.title %> by <%= data.artist %></p>
                                            <p class="diff"><%= data.version %></p>
                                        </a>
                                        <% if (data.mods !== 0) { %>
                                            <div class="mods">
                                                <% getMods(data.mods).forEach((mod) => { %>
                                                    <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <% }); %>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="flex results">
                                        <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } %>
                                        </p>
                                        <% if (!dans) { %>
                                            <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt++)).toLocaleString() %>pp)</p>
                                        <% } %>
                                    </div>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                </div>
                <% for (let i = 0; i * 50 < bestpp.length; i++) { %>
                    <% if (i === 0) { %>
                        <% if (bestpp.length > 5) { %>
                            <button class="show-more bp to50">
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                                show more
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <button class="show-more bp to<%= (i + 1) * 50 %>" style="display: none">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } %>
                <!-- first place -->
                <div class="box first_place">
                    <h1><i class="fa-solid fa-medal"></i>First Place Ranks</h1>
                    <div class="mode-<%= modeNum %>">
                        <% amt = 0; %>
                        <% if (firstPlace.length === 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% firstPlace.forEach((data) => { %>
                                <div class="wrap data">
                                    <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>
                                    style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <div class="mods">
                                        <% getMods(data.mods).forEach((mod) => { %>
                                            <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% }); %>
                                    </div>
                                    <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                    <div class="pp">
                                        <p class="recorded"
                                            <% if (dans) { %>
                                                style="margin: auto";
                                            <% } %>>
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } %>
                                        </p>
                                        <% if (!dans) { %>
                                            <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt)).toLocaleString() %>pp)</p>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="data-mobile">
                                    <div class="flex info">
                                        <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <a
                                        <% if (!dans && data.id > 0) { %>
                                            href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                        <% } %>>
                                            <p class="title"><%= data.title %> by <%= data.artist %></p>
                                            <p class="diff"><%= data.version %></p>
                                        </a>
                                        <% if (data.mods !== 0) { %>
                                            <div class="mods">
                                                <% getMods(data.mods).forEach((mod) => { %>
                                                    <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <% }); %>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="flex results">
                                        <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } %>
                                        </p>
                                        <% if (!dans) { %>
                                            <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt++)).toLocaleString() %>pp)</p>
                                        <% } %>
                                    </div>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                </div>
                <% for (let i = 0; i * 50 < firstPlace.length; i++) { %>
                    <% if (i === 0) { %>
                        <% if (bestpp.length > 5) { %>
                            <button class="show-more fp to50">
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                                show more
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <button class="show-more fp to<%= (i + 1) * 50 %>" style="display: none">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } %>
                <!-- most plays -->
                <div class="box mostplays">
                    <h1><i class="fa-regular fa-circle-play"></i>Most Plays</h1>
                    <div class="mode-<%= modeNum %>">
                        <% if (mostplays.length <= 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% mostplays.forEach((data) => { %>
                                <div class="data"
                                <% if (dans) { %>
                                    style="height: 55px;"
                                <% } %>>
                                    <% if (!dans) { %>
                                        <img src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% } %>
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>>
                                        <p class="title"><%= data.title %> [<%= data.version%>] by <%= data.artist %></p>
                                        <p class="mapper">mapped by <span><%= data.creator %></span></p>
                                    </a>
                                    <i class="mode-icon mode-<%= getMode(data.mode) %>"></i>
                                    <div>
                                        <i class="fa-solid fa-play play-icon"></i>
                                        <p class="value"><%= data.playtimes.toLocaleString() %></p>
                                    </div>
                                </div>
                                <div class="data-mobile"
                                <% if (dans) {%>
                                    style="height: 54px;"
                                <% } %>>
                                    <div class="mapbg"
                                    <% if (dans) {%>
                                        style="background-color: unset; height: 54px;"
                                    <% } %>>
                                        <% if (!dans) { %>
                                            <img src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% } %>
                                        <div>
                                            <i class="fa-solid fa-play play-icon"></i>
                                            <p class="value"><%= data.playtimes.toLocaleString() %></p>
                                        </div>
                                    </div>
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>>
                                        <p class="title"><%= data.title %> [<%= data.version%>] by <%= data.artist %></p>
                                        <p class="mapper">mapped by <span><%= data.creator %></span></p>
                                    </a>
                                    <i class="mode-icon mode-<%= getMode(data.mode) %>"></i>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                </div>
                <% for (let i = 0; i * 50 < mostplays.length; i++) { %>
                    <% if (i === 0) { %>
                        <% if (mostplays.length > 5) { %>
                            <button class="show-more mp to50">
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                                show more
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <button class="show-more mp to<%= (i + 1) * 50 %>" style="display: none">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } %>
                <!-- recent plays -->
                <div class="box recentplays">
                    <div class="flex">
                        <h1><i class="fa-regular fa-calendar-days"></i>Recent Plays</h1>
                        <button class="all">Show all</button>
                        <button class="passed" style="filter: invert(0%); opacity: 1;">Only passed</button>
                    </div>
                    <div class="mode-<%= modeNum %>">
                        <!-- Show all -->
                        <% if (recentplays.length <= 0) { %>
                            <h1 class="nothing" style="display: none;">No scores available</h1>
                        <% } else { %>
                            <% recentplays.forEach((data) => { %>
                                <div class="data" style="display: none;">
                                    <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% } else { %>
                                        <img class="grade" src="/image/grade/F.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% } %>
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id %>/<%= data.id %>"
                                    <% } %>
                                    style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <div class="mods">
                                        <% getMods(data.mods).forEach((mod) => { %>
                                            <img title="<%= mod %>" class="mod" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% }); %>
                                    </div>
                                    <p class="acc">
                                        <% if (dans) { %>
                                            <%= data.sacc.toFixed(2) %>
                                        <% } else { %>
                                            <%= data.acc.toFixed(2) %>
                                        <% } %>
                                        %
                                    </p>
                                    <div class="pp">
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else if (data.grade !== "F") { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                -
                                            <% } %>
                                        </p>
                                        <p class="loved">
                                            <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                                (Loved)
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                                <div class="data-mobile" style="display: none;">
                                    <div class="flex info">
                                        <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                            <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% } else { %>
                                            <img class="grade" src="/image/grade/F.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% } %>
                                        <a
                                        <% if (!dans && data.id > 0) { %>
                                            href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                        <% } %>>
                                            <p class="title"><%= data.title %> by <%= data.artist %></p>
                                            <p class="diff"><%= data.version %></p>
                                        </a>
                                        <% if (data.mods !== 0) { %>
                                            <div class="mods">
                                                <% getMods(data.mods).forEach((mod) => { %>
                                                    <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <% }); %>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="flex results">
                                        <p class="acc">
                                            <% if (dans) { %>
                                                <%= data.sacc.toFixed(2) %>
                                            <% } else { %>
                                                <%= data.acc.toFixed(2) %>
                                            <% } %>
                                            %
                                        </p>
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else if (data.grade !== "F") { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                -
                                            <% } %>
                                        </p>
                                        <p class="loved">
                                            <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                                (Loved)
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                            <% }); %>
                        <% } %>
                        <!-- Only passed -->
                        <% if (recentplays_nof.length <= 0) { %>
                            <h1 class="nothing-passed">No scores available</h1>
                        <% } else { %>
                            <% recentplays_nof.forEach((data) => { %>
                                <div class="data-passed">
                                    <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% } else { %>
                                        <img class="grade" src="/image/grade/F.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                    <% } %>
                                    <a
                                    <% if (!dans && data.id > 0) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>
                                    style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <div class="mods">
                                        <% getMods(data.mods).forEach((mod) => { %>
                                            <img class="mod" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% }); %>
                                    </div>
                                    <p class="acc">
                                        <% if (dans) { %>
                                            <%= data.sacc.toFixed(2) %>
                                        <% } else { %>
                                            <%= data.acc.toFixed(2) %>
                                        <% } %>
                                        %
                                    </p>
                                    <div class="pp">
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else if (data.grade !== "F") { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                -
                                            <% } %>
                                        </p>
                                        <p class="loved">
                                            <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                                (Loved)
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                                <div class="data-mobile-passed">
                                    <div class="flex info">
                                        <img class="mapbg" src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                            <img class="grade" src="/image/grade/<%= data.grade %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% } else { %>
                                            <img class="grade" src="/image/grade/F.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                        <% } %>
                                        <a
                                        <% if (!dans && data.id > 0) { %>
                                            href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                        <% } %>>
                                            <p class="title"><%= data.title %> by <%= data.artist %></p>
                                            <p class="diff"><%= data.version %></p>
                                        </a>
                                        <% if (data.mods !== 0) { %>
                                            <div class="mods">
                                                <% getMods(data.mods).forEach((mod) => { %>
                                                    <img class="img" src="/image/mods/<%= mod %>.png?<%= date %>" decoding="async" loading="lazy" alt="" />
                                                <% }); %>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="flex results">
                                        <p class="acc">
                                            <% if (dans) { %>
                                                <%= data.sacc.toFixed(2) %>
                                            <% } else { %>
                                                <%= data.acc.toFixed(2) %>
                                            <% } %>
                                            %
                                        </p>
                                        <p class="recorded">
                                            <% if (!dans) { %>
                                                <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                            <% } else if (data.grade !== "F") { %>
                                                <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                            <% } else { %>
                                                -
                                            <% } %>
                                        </p>
                                        <p class="loved">
                                            <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                                (Loved)
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                </div>
                <% for (let i = 0; i * 50 < recentplays.length; i++) { %>
                    <% if (i === 0) { %>
                        <% if (recentplays.length > 5) { %>
                            <button class="show-more rp to50" style="display: none;">
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                                show more
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <button class="show-more rp to<%= (i + 1) * 50 %>" style="display: none">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } %>
                <% for (let i = 0; i * 50 < recentplays_nof.length; i++) { %>
                    <% if (i === 0) { %>
                        <% if (recentplays_nof.length > 5) { %>
                            <button class="show-more rp nof to50">
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                                show more
                                <i class="fa-solid fa-chevron-down arrow down"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <button class="show-more rp nof to<%= (i + 1) * 50 %>" style="display: none">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } %>
            <% } else { %>
                <div class="box member">
                    <h1><i class="fa-solid fa-people-group"></i>Clan Member</h1>
                    <div class="member-table">
                        <div class="head">
                            <span class="acc">Acc</span>
                            <span class="plays">Plays</span>
                            <span class="pp">PP</span>
                            <span class="score"
                            <% if (dans) { %>
                                style="filter: invert(50%); opacity: 0.95;"
                            <% } %>>Score</span>
                        </div>
                        <div class="mode-<%= modeNum %>">
                            <div class="data owner">
                                <span class="item status">
                                    <span class="blowing">
                                        <i class="fa-solid fa-crown"></i>
                                        <p class="tooltip">Owner</p>
                                    </span>
                                </span>
                                <span class="item avatar"><img src="https://a.mamesosu.net/<%= owner.id %>?<%= date %>" decoding="async" loading="lazy" alt="" /></span>
                                <span class="item country"><i title="<%= owner.country.toUpperCase() %>" class="flag-icon flag-icon-<%= owner.country %>"></i></span>
                                <span class="item username"><a href="/profile/<%= owner.id %>"><%= owner.name %></a></span>
                                <span class="item tag">
                                    <% getUserPriv(owner.priv).forEach((tag) => { %>
                                        <span class="badge">
                                            <% if (tag === "Developer") { %>
                                                <i class="fa-solid fa-code" style="color: #3e70dd;"></i>
                                            <% } else if (tag === "Administrator") { %>
                                                <i class="fa-solid fa-crown" style="color: #f1c40f;"></i>
                                            <% } else if (tag === "Moderator") { %>
                                                <i class="fa-solid fa-shield-halved" style="color: #cf5757;"></i>
                                            <% } else if (tag === "Nominator") { %>
                                                <i class="fa-solid fa-screwdriver-wrench" style="color: #9000fc;"></i>
                                            <% } else if (tag === "Arumni") { %>
                                                <i class="fa-solid fa-graduation-cap" style="color: #99aab5;"></i>
                                            <% } else if (tag === "Supporter") { %>
                                                <i class="fa-solid fa-heart" style="color: #dd0000;"></i>
                                            <% } else if (tag === "Verified") { %>
                                                <i class="fa-solid fa-check" style="color: #3ce12f;"></i>
                                            <% } %>
                                            <p class="tooltip"><%= tag %></p>
                                        </span>
                                    <% }); %>
                                    </span>
                                <span class="item acc"
                                <% if (owner.acc === 0) { %>
                                    style="filter: invert(50%); opacity: 0.95;"
                                <% } %>><%= owner.acc.toFixed(2) %>%</span>
                                <span class="item plays"
                                <% if (owner.plays === 0) { %>
                                    style="filter: invert(50%); opacity: 0.95;"
                                <% } %>><%= owner.plays.toLocaleString() %></span>
                                <span class="item pp"
                                <% if (owner.pp === 0) { %>
                                    style="filter: invert(50%); opacity: 0.95;"
                                <% } %>><%= owner.pp.toLocaleString() %></span>
                                <span class="item score"
                                <% if (dans || owner.rscore === 0) { %>
                                    style="filter: invert(50%); opacity: 0.95;"
                                <% } %>><%= owner.rscore.toLocaleString() %></span>
                            </div>
                            <% members.forEach((user) => { %>
                                <div class="data membership">
                                    <span class="item status">
                                        <span class="blowing">
                                            <i class="fa-solid fa-user"></i>
                                            <p class="tooltip">Member</p>
                                        </span>
                                    </span>
                                    <span class="item avatar"><img src="https://a.mamesosu.net/<%= user.id %>?<%= date %>" decoding="async" loading="lazy" alt="" /></span>
                                    <span class="item country"><i title="<%= user.country.toUpperCase() %>" class="flag-icon flag-icon-<%= user.country %>"></i></span>
                                    <span class="item username"><a href="/profile/<%= user.id %>"><%= user.name %></a></span>
                                    <span class="item tag">
                                        <% getUserPriv(user.priv).forEach((tag) => { %>
                                            <span class="badge">
                                                <% if (tag === "Developer") { %>
                                                    <i class="fa-solid fa-code" style="color: #3e70dd;"></i>
                                                <% } else if (tag === "Administrator") { %>
                                                    <i class="fa-solid fa-crown" style="color: #f1c40f;"></i>
                                                <% } else if (tag === "Moderator") { %>
                                                    <i class="fa-solid fa-shield-halved" style="color: #cf5757;"></i>
                                                <% } else if (tag === "Nominator") { %>
                                                    <i class="fa-solid fa-screwdriver-wrench" style="color: #9000fc;"></i>
                                                <% } else if (tag === "Arumni") { %>
                                                    <i class="fa-solid fa-graduation-cap" style="color: #99aab5;"></i>
                                                <% } else if (tag === "Supporter") { %>
                                                    <i class="fa-solid fa-heart" style="color: #dd0000;"></i>
                                                <% } else if (tag === "Verified") { %>
                                                    <i class="fa-solid fa-check" style="color: #3ce12f;"></i>
                                                <% } %>
                                                <p class="tooltip"><%= tag %></p>
                                            </span>
                                        <% }); %>
                                    </span>
                                    <span class="item acc"
                                    <% if (user.acc === 0) { %>
                                        style="filter: invert(50%); opacity: 0.95;"
                                    <% } %>><%= user.acc.toFixed(2) %>%</span>
                                    <span class="item plays"
                                    <% if (user.plays === 0) { %>
                                        style="filter: invert(50%); opacity: 0.95;"
                                    <% } %>><%= user.plays.toLocaleString() %></span>
                                    <span class="item pp"
                                    <% if (user.pp === 0) { %>
                                        style="filter: invert(50%); opacity: 0.95;"
                                    <% } %>><%= Math.round(user.pp).toLocaleString() %></span>
                                    <span class="item score"
                                    <% if (dans || user.rscore === 0) { %>
                                        style="filter: invert(50%); opacity: 0.95;"
                                    <% } %>><%= user.rscore.toLocaleString() %></span>
                                </div>
                            <% }); %>
                        </div>
                    </table>
                </div>
            <% } %>
        </main>
        <%- include("footer") %>
        <script nonce="<%= cspNonce %>">
            let before = `<%= bbcode %>`, hold, preview = false;
            window.addEventListener("DOMContentLoaded", function() {
                if (before.length > 0) {
                    if ((("<%= clan %>" === "false" && "<%= id %>" === "<%= locals.userid %>") || ("<%= clan %>" === "true" && "<%= info.owner %>" === "<%= locals.userid %>")) && !preview) {
                        $("main .me .edit-button").show();
                    }
                    bbCodeToHtml();
                }
                else {
                    $("main .me .edit-button").hide();
                }
                $("#put-bbcode").show();
            });

            function clickFollowButton() {
                updateFollowButton();
                getRelationships();
            }

            function updateFollowButton() {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", "/follow", true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function() {
                    document.getElementById("follow").innerHTML = ajax.responseText;
                }
                ajax.send("<%= id %>");
            }

            function getRelationships() {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", "/relationships", true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function() {
                    document.getElementById("relationships").innerHTML = ajax.responseText;
                }
                ajax.send("<%= id %>");
            }

            function setFavoriteMode() {
                const ajax = new XMLHttpRequest();
                ajax.open("GET", "/preferred/<%= id %>&<%= clan %>/<%= modeNum %>&<%= dans %>", true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function() {
                    document.getElementById("selection").innerHTML = ajax.responseText;
                    var $menu = $("main .player-banner .selection .special .menu-title");
                    var $dropdown = $("main .player-banner .selection .special .dropdown");
                    $menu.click(function() {
                        if ($dropdown.hasClass("show")) {
                            $dropdown.fadeOut(300);
                            $dropdown.removeClass("show");
                        }
                        else {
                            $dropdown.fadeIn(300);
                            $dropdown.addClass("show");
                        }
                    });
                }
                ajax.send(null);
            }

            function bbCodeToHtml() {
                const element = document.getElementById("put-bbcode");
                const htmlContent = element.innerText;
                element.innerHTML = htmlContent;
            }

            function cancel() {
                let sure;
                const meEditor = document.getElementById("me-editor");
                if (meEditor.value !== before) {
                    sure = confirm("Unsaved changes will be lost. Are you sure?");
                }
                else {
                    sure = true;
                }
                if (sure) {
                    meEditor.value = before;
                    preview = false;
                    prevMe(document.getElementById("put-bbcode"));
                    $("main .me .edit-button").show();
                    $("main .me .contents form .editor .edit .preview").show();
                    $("main .me .contents form .editor .edit .back-to-edit").hide();
                    $("main .me .contents .bbcode-profile").show();
                    $("main .me .contents form textarea").show();
                    $("main .me .contents form .editor .bb-button").show();
                    $("main .me .contents form").hide();
                }
            }

            function showPreview(content) {
                if (document.getElementById("me-editor").value.length > 0) {
                    preview = true;
                    ajaxUpdate("/preview", document.getElementById("put-bbcode"));
                    $("main .me .contents form .editor .edit .preview").hide();
                    $("main .me .contents form .editor .edit .back-to-edit").show();
                    $("main .me .contents .bbcode-profile").show();
                    $("main .me .contents form textarea").hide();
                    $("main .me .contents form .editor .bb-button").hide();
                }
            }

            function backToEditor() {
                preview = false;
                $("main .me .contents form .editor .edit .preview").show();
                $("main .me .contents form .editor .edit .back-to-edit").hide();
                $("main .me .contents .bbcode-profile").hide();
                $("main .me .contents form textarea").show();
                $("main .me .contents form .editor .bb-button").show();
            }

            function save() {
                preview = false;
                before = document.getElementById("me-editor").value;
                ajaxUpdate("/me/<%= id %>&clan=<%= !clan ? 0 : 1 %>", document.getElementById("put-bbcode"));
                $("main .me .edit-button").show();
                $("main .me .contents form .editor .edit .preview").show();
                $("main .me .contents form .editor .edit .back-to-edit").hide();
                $("main .me .contents .bbcode-profile").show();
                $("main .me .contents form textarea").show();
                $("main .me .contents form .editor .bb-button").show();
                $("main .me .contents form").hide();
            }

            function ajaxUpdate (link, element) {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", link, true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function () {
                    element.innerHTML = ajax.responseText;
                    if (before.length > 0) {
                        if ((("<%= clan %>" === "false" && "<%= id %>" === "<%= locals.userid %>") || ("<%= clan %>" === "true" && "<%= info.owner %>" === "<%= locals.userid %>")) && !preview) {
                            $("main .me .edit-button").show();
                        }
                        bbCodeToHtml();
                    }
                    else {
                        $("main .me .edit-button").hide();
                    }
                    $("main .me .contents .edit-me").click(function() {
                        $("main .me .contents .bbcode-profile").hide();
                        $("main .me .contents form").show();
                    });
                    var $boxName = $("main .me .contents .spoilerbox p");
                    $boxName.click(function() {
                        if ($(this).hasClass("down")) {
                            $(this).removeClass("down");
                            $("main .me .contents .spoilerbox div").eq($boxName.index(this)).removeClass("show-content");
                        }
                        else {
                            $(this).addClass("down");
                            $("main .me .contents .spoilerbox div").eq($boxName.index(this)).addClass("show-content");
                        }
                    });
                }
                ajax.send(document.getElementById("me-editor").value);
            }

            function prevMe(element) {
                const ajax = new XMLHttpRequest();
                ajax.open("GET", "/me/<%= id %>&clan=<%= !clan ? 0 : 1 %>", true);
                ajax.onload = function () {
                    element.innerHTML = ajax.responseText;
                    if (before.length > 0) {
                        if ((("<%= clan %>" === "false" && "<%= id %>" === "<%= locals.userid %>") || ("<%= clan %>" === "true" && "<%= info.owner %>" === "<%= locals.userid %>")) && !preview) {
                            $("main .me .edit-button").show();
                        }
                        bbCodeToHtml();
                    }
                    else {
                        $("main .me .edit-button").hide();
                    }
                    $("main .me .contents .edit-me").click(function() {
                        $("main .me .contents .bbcode-profile").hide();
                        $("main .me .contents form").show();
                    });
                    var $boxName = $("main .me .contents .spoilerbox p");
                    $boxName.click(function() {
                        if ($(this).hasClass("show-content")) {
                            $(this).removeClass("show-content");
                            $("main .me .contents .spoilerbox div").eq($boxName.index(this)).removeClass("show-content");
                        }
                        else {
                            $(this).addClass("show-content");
                            $("main .me .contents .spoilerbox div").eq($boxName.index(this)).addClass("show-content");
                        }
                    });
                }
                ajax.send(null);
            }
        </script>
    </body>
</html>
